<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body {
            background-color: black;
            color: white;
            font-family: monospace;
            margin: 0;
            padding: 20px;
        }
        #chatbox {
            height: 80vh;
            overflow-y: auto;
            border: 1px solid #333;
            padding: 10px;
            margin-bottom: 10px;
        }
        #message {
            width: 70%;
            background: #222;
            color: white;
            border: 1px solid #333;
            padding: 5px;
        }
        button {
            background: #222;
            color: white;
            border: 1px solid #333;
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="chatbox"></div>
    <input type="text" id="message" placeholder="Type your message...">
    <button onclick="sendMessage()">Send</button>

    <script>
        // Function to generate a username based on IP
        function generateUsername(ip) {
            const adjectives = ["Red", "Blue", "Green", "Yellow", "Purple", "Swift", "Clever", "Mystic", "Silent", "Brave"];
            const nouns = ["Fox", "Wolf", "Eagle", "Dragon", "Phoenix", "Lion", "Tiger", "Bear", "Hawk", "Falcon"];
            
            // Create a simple hash from the IP
            let hash = 0;
            for (let i = 0; i < ip.length; i++) {
                hash = ((hash << 5) - hash) + ip.charCodeAt(i);
                hash = hash & hash; // Convert to 32-bit integer
            }
            
            // Use the hash to select from arrays
            const adjIndex = Math.abs(hash) % adjectives.length;
            const nounIndex = Math.abs(hash >> 8) % nouns.length;
            const number = Math.abs(hash >> 16) % 1000;
            
            return adjectives[adjIndex] + nouns[nounIndex] + number;
        }

        // Function to get the user's IP address
        async function getIP() {
            try {
                // Try to get IP from a third-party service
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                // Fallback to a random IP if the API fails
                console.error("Could not get IP address:", error);
                return "192.168." + Math.floor(Math.random() * 255) + "." + Math.floor(Math.random() * 255);
            }
        }

        // Initialize the chat
        let username = "Guest";
        let messages = JSON.parse(localStorage.getItem('chatMessages')) || [];

        async function initializeChat() {
            const ip = await getIP();
            username = generateUsername(ip);
            displayMessages();
        }

        // Display messages in the chatbox
        function displayMessages() {
            const chatbox = document.getElementById('chatbox');
            chatbox.innerHTML = '';
            
            // Only show the last 20 messages
            const recentMessages = messages.slice(-20);
            
            recentMessages.forEach(msg => {
                const messageElement = document.createElement('div');
                messageElement.textContent = `[${msg.time}] ${msg.user}: ${msg.text}`;
                chatbox.appendChild(messageElement);
            });
            
            // Scroll to the bottom
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        // Send a new message
        function sendMessage() {
            const messageInput = document.getElementById('message');
            const messageText = messageInput.value.trim();
            
            if (messageText) {
                const now = new Date();
                const timeString = now.toLocaleTimeString();
                
                // Add the new message
                messages.push({
                    user: username,
                    text: messageText,
                    time: timeString
                });
                
                // Keep only the last 20 messages
                if (messages.length > 20) {
                    messages = messages.slice(-20);
                }
                
                // Save to localStorage
                localStorage.setItem('chatMessages', JSON.stringify(messages));
                
                // Update display and clear input
                displayMessages();
                messageInput.value = '';
            }
        }

        // Allow sending message with Enter key
        document.getElementById('message').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        // Initialize the chat when the page loads
        window.onload = initializeChat;
    </script>
</body>
</html>
